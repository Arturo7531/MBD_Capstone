<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Capstone Project</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="Capstone_R_Doc_files/libs/clipboard/clipboard.min.js"></script>
<script src="Capstone_R_Doc_files/libs/quarto-html/quarto.js"></script>
<script src="Capstone_R_Doc_files/libs/quarto-html/popper.min.js"></script>
<script src="Capstone_R_Doc_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Capstone_R_Doc_files/libs/quarto-html/anchor.min.js"></script>
<link href="Capstone_R_Doc_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Capstone_R_Doc_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Capstone_R_Doc_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Capstone_R_Doc_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Capstone_R_Doc_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Capstone Project</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="capstone-project---time-series-analysis" class="level1">
<h1><strong>Capstone Project - Time Series Analysis</strong></h1>
<p><strong>Objective</strong>: Sales forecast for the upcoming two months for 14 different products. In this notebook, we will be taking a time series approach to the problem.<br>
</p>
<p><strong>Data:</strong> A CSV file containing three different columns:</p>
<ul>
<li><p>Year-Week: Year and number of week corresponding to the Units column</p></li>
<li><p>ID_Material: Internal identification number of the product</p></li>
<li><p>Units: Amount sold for each product, which is also our target variable</p></li>
</ul>
<section id="preliminary-steps" class="level2">
<h2 class="anchored" data-anchor-id="preliminary-steps">Preliminary Steps</h2>
<p>We import the following packages into our environment (packages are similar to libraries in Python).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(prophet)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ISOweek)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(zoo)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="data-ingestion" class="level3">
<h3 class="anchored" data-anchor-id="data-ingestion">Data Ingestion</h3>
<p>Next, we import the data provided for analysis.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"KPMG.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="data-cleaning">Data Cleaning</h3>
<p>We begin the analysis with the following data structure.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  year.week ID_material Units
1   2019-11   120010970   540
2   2019-12   120010970   750
3   2019-13   120010970   960
4   2019-14   120010970   720
5   2019-15   120010970  1620
6   2019-16   120010970   900</code></pre>
</div>
</div>
<p>The first step in the data cleaning process is to create a new datetime variable with the year-week variable (<em>year.week</em>). In order to create a date type, we must assume a day value for each week-year combination. Let us assume day 1 for simplicity.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>date_in_week <span class="ot">&lt;-</span> <span class="cf">function</span>(yrwk){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  w <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">str_split</span>(yrwk, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">1</span>],</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>              <span class="st">"-W"</span>, </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">str_split</span>(yrwk, <span class="st">"-"</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>], </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>              <span class="st">"-"</span>, </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>              <span class="dv">1</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ISOweek2date</span>(w)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>date <span class="ot">&lt;-</span> <span class="fu">as_date</span>(<span class="fu">apply</span>(data, <span class="dv">1</span>, date_in_week))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  year.week ID_material Units       date
1   2019-11   120010970   540 2019-03-11
2   2019-12   120010970   750 2019-03-18
3   2019-13   120010970   960 2019-03-25
4   2019-14   120010970   720 2019-04-01
5   2019-15   120010970  1620 2019-04-08
6   2019-16   120010970   900 2019-04-15</code></pre>
</div>
</div>
<p>The next step is to split the data into 14 different tables, one for each individual product in the data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>products <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="fu">unique</span>(data<span class="sc">$</span>ID_material))){</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">paste0</span>(i, <span class="st">"_df"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  products[[x]] <span class="ot">&lt;-</span> <span class="fu">subset</span>(data, ID_material <span class="sc">==</span> i)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  products[[x]]<span class="sc">$</span>ds <span class="ot">&lt;-</span> <span class="fu">as_date</span>(products[[x]]<span class="sc">$</span>date)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  products[[x]]<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(products[[x]]<span class="sc">$</span>Units)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  products[[x]] <span class="ot">&lt;-</span> products[[x]][<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>]</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here we can see the first records of the table for one of the products, where <em>ds</em> is the date and <em>y</em> are the units sold for that date’s week.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>          ds    y
1 2019-03-11  540
2 2019-03-18  750
3 2019-03-25  960
4 2019-04-01  720
5 2019-04-08 1620
6 2019-04-15  900</code></pre>
</div>
</div>
<p>Thanks to the results provided in the Python notebook that is also part of this project, it seems like each product’s units sold over the past years appears to be quite volatile with no apparent trend or seasonality. Now let’s try decomposing each time series to find any useful insights.</p>
</section>
</section>
<section id="time-series-decomposition" class="level2">
<h2 class="anchored" data-anchor-id="time-series-decomposition">Time Series Decomposition</h2>
<p>In order to understand better the data we are working with we proceed to decompose each time series into its different elements. For this purpose, we use the decompose function of the stats package. It decomposes a time series into seasonal, trend, and irregular components.</p>
<p>Here’s an example on one of the products:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>decomposed <span class="ot">&lt;-</span> <span class="fu">decompose</span>(<span class="fu">ts</span>(products[[<span class="dv">1</span>]][<span class="dv">2</span>], <span class="at">frequency =</span> <span class="dv">52</span>), <span class="at">type=</span><span class="st">"add"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(decomposed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Capstone_R_Doc_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This process was repeated for all the products and a few special cases were picked to show in the full report.</p>
</section>
<section id="time-series-modeling" class="level2">
<h2 class="anchored" data-anchor-id="time-series-modeling">Time Series Modeling</h2>
<section id="data-splitting" class="level3">
<h3 class="anchored" data-anchor-id="data-splitting">Data Splitting</h3>
<p>The first thing to do is to do a train-test split. We will use all but the last 8 rows of the data set to train our model and use the last 8 to test the predictions. This will give us a good idea on how the model will work to forecast 2 months of weekly data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>training <span class="ot">&lt;-</span> products[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(.)<span class="sc">-</span><span class="dv">8</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>testing <span class="ot">&lt;-</span> products[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>((<span class="fu">nrow</span>(.)<span class="sc">-</span><span class="dv">7</span>)<span class="sc">:</span><span class="fu">nrow</span>(.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sarima-analysis" class="level3">
<h3 class="anchored" data-anchor-id="sarima-analysis">SARIMA Analysis</h3>
<p>We fit our data into a SARIMA model, and forecast the next 8 values. It’s important to mention that the bootstrap parameter was turned on to get more accurate results, although this results in longer computing times.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sarima_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(training[[<span class="dv">2</span>]], <span class="at">D=</span><span class="dv">1</span>,<span class="at">approximation =</span> F,<span class="at">allowdrift =</span> T,<span class="at">allowmean =</span> T)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>sarima_model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: training[[2]] 
ARIMA(2,0,2) with non-zero mean 

Coefficients:
         ar1      ar2      ma1     ma2       mean
      1.5821  -0.9411  -1.4462  0.8492  1178.7825
s.e.  0.0602   0.0473   0.0849  0.0642    58.7061

sigma^2 = 499485:  log likelihood = -1418.26
AIC=2848.52   AICc=2849.01   BIC=2867.61</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>forecast_sarima <span class="ot">&lt;-</span> <span class="fu">forecast</span>(sarima_model, <span class="at">bootstrap =</span> T, <span class="at">h =</span> <span class="dv">8</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecast_sarima)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Capstone_R_Doc_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Finally, we compare the predicted values against the actual data we put aside for testing and get the mean absolute error (MAE) as a performance metric.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 525.8074</code></pre>
</div>
</div>
<p>The same process is repeated for all products.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>a_model_errors <span class="ot">=</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="at">length =</span> <span class="dv">0</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)){</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  temp_training <span class="ot">&lt;-</span> products[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(.)<span class="sc">-</span><span class="dv">8</span>))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  temp_testing <span class="ot">&lt;-</span> products[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>((<span class="fu">nrow</span>(.)<span class="sc">-</span><span class="dv">7</span>)<span class="sc">:</span><span class="fu">nrow</span>(.))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  temp_a_model <span class="ot">&lt;-</span> <span class="fu">auto.arima</span>(temp_training[[<span class="dv">2</span>]], <span class="at">D=</span><span class="dv">1</span>,<span class="at">approximation =</span> F,<span class="at">allowdrift =</span> T,<span class="at">allowmean =</span> T)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  temp_forecast_sarima <span class="ot">&lt;-</span> <span class="fu">forecast</span>(temp_a_model, <span class="at">bootstrap =</span> T, <span class="at">h =</span> <span class="dv">8</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  a_model_errors <span class="ot">&lt;-</span> <span class="fu">c</span>(a_model_errors, <span class="fu">mae</span>(temp_testing[[<span class="dv">2</span>]], temp_forecast_sarima<span class="sc">$</span>mean))</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>a_model_errors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  525.80740  975.62500  139.93624 3607.11334  162.14768  310.07262
 [7]   77.66587  775.93608   78.61346  222.40023  314.99123  879.31243
[13]  734.35720  813.38532</code></pre>
</div>
</div>
</section>
<section id="prophet-analysis" class="level3">
<h3 class="anchored" data-anchor-id="prophet-analysis">Prophet Analysis</h3>
<p>Lastly, the Prophet toolkit from Meta was used to attempt a similar analysis. We’ll use the same train-test split data as we did for the SARIMA section for demonstrations purposes and to have a point of reference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>prophet_model <span class="ot">&lt;-</span> <span class="fu">prophet</span>(training)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>future_df <span class="ot">&lt;-</span> <span class="fu">make_future_dataframe</span>(prophet_model, <span class="at">periods =</span> <span class="fu">length</span>(testing[[<span class="dv">1</span>]]), <span class="at">freq =</span> <span class="st">"week"</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>forecast_prophet <span class="ot">&lt;-</span> <span class="fu">predict</span>(prophet_model, future_df)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(prophet_model, forecast_prophet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Capstone_R_Doc_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Then, we calculate the MAE for the predictions given by this model against the same testing data as with the SARIMA model before.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 502.2012</code></pre>
</div>
</div>
<p>The same process is repeated for all products.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>p_model_errors <span class="ot">=</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, <span class="at">length =</span> <span class="dv">0</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">14</span>)){</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  temp_training <span class="ot">&lt;-</span> products[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">nrow</span>(.)<span class="sc">-</span><span class="dv">8</span>))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  temp_testing <span class="ot">&lt;-</span> products[[i]] <span class="sc">%&gt;%</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>((<span class="fu">nrow</span>(.)<span class="sc">-</span><span class="dv">7</span>)<span class="sc">:</span><span class="fu">nrow</span>(.))</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  temp_prophet_model <span class="ot">&lt;-</span> <span class="fu">prophet</span>(temp_training)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  temp_future_df <span class="ot">&lt;-</span> <span class="fu">make_future_dataframe</span>(temp_prophet_model, <span class="at">periods =</span> <span class="fu">length</span>(temp_testing[[<span class="dv">1</span>]]), <span class="at">freq =</span> <span class="st">"week"</span>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  temp_forecast_prophet <span class="ot">&lt;-</span> <span class="fu">predict</span>(temp_prophet_model, temp_future_df)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  temp_forecast_prophet <span class="ot">&lt;-</span> temp_forecast_prophet <span class="sc">%&gt;%</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice</span>((<span class="fu">nrow</span>(.)<span class="sc">-</span><span class="dv">7</span>)<span class="sc">:</span><span class="fu">nrow</span>(.))</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  p_model_errors <span class="ot">&lt;-</span> <span class="fu">c</span>(p_model_errors, <span class="fu">mae</span>(temp_testing[[<span class="dv">2</span>]], temp_forecast_prophet<span class="sc">$</span>yhat))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>p_model_errors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  502.20121  982.74302  200.84745 2662.04740  245.87177  338.45777
 [7]  102.34760 1372.99959   69.44366  396.27493  255.81090  988.65934
[13]  695.42752  790.83937</code></pre>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>